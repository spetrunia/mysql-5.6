show variables like 'rocksdb_use_range_locking';
Variable_name	Value
rocksdb_use_range_locking	ON
create table t0(a int primary key);
insert into t0 values (0),(1),(2),(3),(4),(5),(6),(7),(8),(9);
create table t1 (
pk int,
a int,
primary key (pk)
) engine=rocksdb;
insert into t1 select
A.a + B.a*10 + C.a*100,
A.a + B.a*10 + C.a*100
from 
t0 A, t0 B, t0 C;
# Make another connection to get the lock tree out of the STO-mode
connect  con1,localhost,root,,;
connection con1;
begin;
select * from t1 where pk=10 for update;
pk	a
10	10
connection default;
begin;
select * from t1 where pk=11 for update;
pk	a
11	11
# Now, we will just see locks on 10=0xA and 11=0xB:
# select * from information_schema.rocksdb_locks; # With replacements by select_from_is_rowlocks.inc
COLUMN_FAMILY_ID	TRANSACTION_ID	KEY	mode
$cf_id	$trx_id	0000${indexnr}8000000b	X
$cf_id	6	0000${indexnr}8000000a	X
#
#  SeekForUpdate Test #1: A query with type=range (without upper bound) and LIMIT 
#
explain
select * from t1 where pk>=500 order by pk limit 3 for update;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	range	PRIMARY	PRIMARY	4	NULL	#	Using where
select * from t1 where pk>=500 order by pk limit 3 for update;
pk	a
500	500
501	501
502	502
# select * from information_schema.rocksdb_locks; # With replacements by select_from_is_rowlocks.inc
COLUMN_FAMILY_ID	TRANSACTION_ID	KEY	mode
$cf_id	$trx_id	0000${indexnr}800001f4 - 0000${indexnr}800001f6	X
$cf_id	$trx_id	0000${indexnr}8000000b	X
$cf_id	6	0000${indexnr}8000000a	X
rollback;
begin;
select * from t1 where pk=11 for update;
pk	a
11	11
explain
select * from t1 order by pk limit 3 for update;
id	select_type	table	type	possible_keys	key	key_len	ref	rows	Extra
1	SIMPLE	t1	index	NULL	PRIMARY	4	NULL	3	NULL
select * from t1 order by pk limit 3 for update;
pk	a
0	0
1	1
2	2
# select * from information_schema.rocksdb_locks; # With replacements by select_from_is_rowlocks.inc
COLUMN_FAMILY_ID	TRANSACTION_ID	KEY	mode
$cf_id	$trx_id	0000${indexnr}8000000b	X
$cf_id	6	0000${indexnr}8000000a	X
$cf_id	$trx_id	0000${indexnr} - 0000${indexnr}80000002	X
rollback;
connection con1;
rollback;
disconnect con1;
connection default;
drop table t0, t1;
